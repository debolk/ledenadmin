// Generated by CoffeeScript 1.6.2
(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  Bolk.AjaxRequest = (function() {
    function AjaxRequest(secure, api, params, method) {
      this.secure = secure != null ? secure : true;
      this.api = api;
      this.params = params != null ? params : {};
      this.method = method != null ? method : 'get';
      this.onFail = __bind(this.onFail, this);
      console.debug("" + this.method + " " + (this.url()));
      if (!this.params['access_token'] && this.secure) {
        this.api = this.api + '?access_token=' + document.router.session.token;
      }
      this.result = void 0;
      console.log(this.method);
      this.request = this.execute();
    }

    AjaxRequest.prototype.url = function() {
      return "" + this.endpoint + this.api;
    };

    AjaxRequest.prototype.options = function() {
      return {
        url: this.url(),
        type: this.method,
        data: this.params
      };
    };

    AjaxRequest.prototype.execute = function() {
      return jQuery.ajax(this.options()).done(this.onSuccess).fail(this.onFail).always(this.onDone);
    };

    AjaxRequest.prototype.onSuccess = function(data) {
      return console.log(data);
    };

    AjaxRequest.prototype.onFail = function(error) {
      console.error("Error occurred on request " + (this.statify()));
      console.error("" + (error.statusCode()) + " " + error.statusText + ": " + error.responseText);
      return console.error(error);
    };

    AjaxRequest.prototype.onDone = function() {};

    AjaxRequest.prototype.statify = function() {
      return JSON.stringify({
        api: this.api,
        method: this.method,
        endpoint: this.endpoint,
        params: this.params
      });
    };

    AjaxRequest.generate = function(state) {
      var request;

      if (state instanceof String) {
        state = JSON.parse(state);
      }
      request = new AjaxRequest(state.api, state.method);
      Object.defineProperty(request, 'endpoint', {
        get: function() {
          return state.endpoint;
        }
      });
      return request;
    };

    return AjaxRequest;

  })();

}).call(this);
